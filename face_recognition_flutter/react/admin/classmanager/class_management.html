<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Attendance - Quản lý lớp học</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="../../services/api-service.js"></script>
    <script src="../../services/auth-service.js"></script>
    <link rel="stylesheet" href="class_management.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <span class="logo-text">Face Attendance</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="../dashboard/admin_dashboard.html" class="nav-item" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="../usermanager/user_management.html" class="nav-item" data-page="users">
                    <i class="fas fa-users"></i>
                    <span class="nav-text">Quản lý người dùng</span>
                </a>
                <a href="../classmanager/class_management.html" class="nav-item active" data-page="classes">
                    <i class="fas fa-school"></i>
                    <span class="nav-text">Quản lý lớp học</span>
                </a>
                <a href="#" class="nav-item" data-page="sessions">
                    <i class="fas fa-calendar-check"></i>
                    <span class="nav-text">Phiên điểm danh</span>
                </a>
                <a href="#" class="nav-item" data-page="subjects">
                    <i class="fas fa-book"></i>
                    <span class="nav-text">Môn học & Lịch</span>
                </a>
                <a href="../faceregister/face_registration.html" class="nav-item" data-page="face-recognition">
                    <i class="fas fa-face-smile"></i>
                    <span class="nav-text">Nhận diện khuôn mặt</span>
                </a>
                <a href="#" class="nav-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-text">Báo cáo</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name">Admin</div>
                        <div class="user-role">Quản trị viên</div>
                    </div>
                </div>
                <button class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Đăng xuất</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 class="page-title">
                        <i class="fas fa-school"></i>
                        Quản lý lớp học
                    </h1>
                    <p class="page-subtitle">Quản lý thông tin lớp học và danh sách sinh viên</p>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="action-btn" id="refreshBtn" title="Làm mới">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="action-btn" id="importBtn" title="Nhập từ Excel">
                            <i class="fas fa-file-import"></i>
                        </button>
                        <button class="action-btn" id="exportBtn" title="Xuất Excel">
                            <i class="fas fa-file-export"></i>
                        </button>
                    </div>
                    <button class="btn btn-primary" id="addClassBtn">
                        <i class="fas fa-plus"></i>
                        Thêm lớp học
                    </button>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="search-section">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchInput" placeholder="Tìm kiếm theo tên lớp, mã lớp...">
                            <button class="clear-search" id="clearSearch" style="display: none;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div class="filter-section">
                        <select id="filterByStatus" class="filter-select">
                            <option value="all">Tất cả trạng thái</option>
                            <option value="active">Đang hoạt động</option>
                            <option value="inactive">Tạm dừng</option>
                        </select>

                        <select id="filterByYear" class="filter-select">
                            <option value="all">Tất cả khóa học</option>
                            <option value="2024">Khóa 2024</option>
                            <option value="2023">Khóa 2023</option>
                            <option value="2022">Khóa 2022</option>
                        </select>

                        <button class="btn btn-outline" id="resetFilters">
                            <i class="fas fa-undo"></i>
                            Reset
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #3b82f6;">
                                <i class="fas fa-school"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="totalClasses">0</div>
                                <div class="stat-label">Tổng lớp học</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon" style="background: #10b981;">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="totalStudents">0</div>
                                <div class="stat-label">Tổng sinh viên</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon" style="background: #f59e0b;">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="avgStudentsPerClass">0</div>
                                <div class="stat-label">Trung bình SV/lớp</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon" style="background: #8b5cf6;">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="activeClasses">0</div>
                                <div class="stat-label">Lớp đang hoạt động</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Class List -->
                <div class="classes-section">
                    <div class="section-header">
                        <h2 class="section-title">Danh sách lớp học</h2>
                        <div class="view-options">
                            <button class="view-btn active" data-view="grid">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" data-view="list">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div class="loading-state" id="loadingState" style="display: none;">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Đang tải danh sách lớp học...</p>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div class="empty-state" id="emptyState" style="display: none;">
                        <div class="empty-icon">
                            <i class="fas fa-school"></i>
                        </div>
                        <h3>Chưa có lớp học nào</h3>
                        <p>Bắt đầu bằng cách tạo lớp học đầu tiên của bạn</p>
                        <button class="btn btn-primary" id="emptyAddBtn">
                            <i class="fas fa-plus"></i>
                            Thêm lớp học đầu tiên
                        </button>
                    </div>

                    <!-- Classes Grid -->
                    <div class="classes-grid" id="classesGrid">
                        <!-- Classes will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add/Edit Class Modal -->
    <div class="modal-overlay" id="classModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="classModalTitle">Thêm lớp học mới</h3>
                <button class="modal-close" id="classModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="classForm">
                    <div class="form-group">
                        <label for="className">Tên lớp học <span class="required">*</span></label>
                        <input type="text" id="className" name="className" required placeholder="Ví dụ: CNTT K47">
                        <div class="form-error" id="classNameError"></div>
                    </div>

                    <div class="form-group">
                        <label for="classCode">Mã lớp học</label>
                        <input type="text" id="classCode" name="classCode" placeholder="Ví dụ: CNTT47">
                        <div class="form-help">Để trống để tự động tạo mã</div>
                    </div>

                    <div class="form-group">
                        <label for="classYear">Khóa học</label>
                        <select id="classYear" name="classYear">
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="classDescription">Mô tả</label>
                        <textarea id="classDescription" name="classDescription"
                            placeholder="Mô tả về lớp học (tùy chọn)" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="cancelClassBtn">Hủy</button>
                <button type="button" class="btn btn-primary" id="saveClassBtn">
                    <i class="fas fa-save"></i>
                    Lưu lớp học
                </button>
            </div>
        </div>
    </div>

    <!-- Student Management Modal -->
    <div class="modal-overlay large" id="studentModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="studentModalTitle">Quản lý sinh viên</h3>
                <button class="modal-close" id="studentModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="student-management">
                    <!-- Student Stats -->
                    <div class="student-stats">
                        <div class="stat-item">
                            <span class="stat-label">Tổng sinh viên:</span>
                            <span class="stat-value" id="modalStudentCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Có khuôn mặt:</span>
                            <span class="stat-value" id="modalStudentWithFace">0</span>
                        </div>
                    </div>

                    <!-- Add Student Section -->
                    <div class="add-student-section">
                        <h4>Thêm sinh viên vào lớp</h4>
                        <div class="add-student-form">
                            <select id="availableStudents" class="form-control">
                                <option value="">Chọn sinh viên...</option>
                            </select>
                            <input type="text" id="studentCode" placeholder="Mã sinh viên trong lớp"
                                class="form-control">
                            <button class="btn btn-primary" id="addStudentBtn">
                                <i class="fas fa-plus"></i>
                                Thêm
                            </button>
                        </div>
                    </div>

                    <!-- Student List -->
                    <div class="student-list-section">
                        <div class="section-header">
                            <h4>Danh sách sinh viên</h4>
                            <div class="student-actions">
                                <button class="btn btn-outline btn-sm" id="importStudentsBtn">
                                    <i class="fas fa-file-import"></i>
                                    Nhập Excel
                                </button>
                                <button class="btn btn-outline btn-sm" id="exportStudentsBtn">
                                    <i class="fas fa-file-export"></i>
                                    Xuất Excel
                                </button>
                            </div>
                        </div>

                        <div class="student-search">
                            <div class="search-box small">
                                <i class="fas fa-search"></i>
                                <input type="text" id="studentSearchInput" placeholder="Tìm kiếm sinh viên...">
                            </div>
                        </div>

                        <div class="student-list" id="studentList">
                            <!-- Students will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="closeStudentModalBtn">Đóng</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal small">
            <div class="modal-header">
                <h3 class="modal-title">Xác nhận xóa</h3>
                <button class="modal-close" id="deleteModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-confirmation">
                    <div class="delete-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <p id="deleteMessage">Bạn có chắc chắn muốn xóa item này không?</p>
                    <div class="delete-warning">
                        <small>Hành động này không thể hoàn tác!</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="cancelDeleteBtn">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    <i class="fas fa-trash"></i>
                    Xóa
                </button>
            </div>
        </div>
    </div>

    <!-- File Import Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Nhập dữ liệu từ Excel</h3>
                <button class="modal-close" id="importModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="import-section">
                    <div class="file-upload-area" id="fileUploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p>Kéo thả file Excel vào đây hoặc <button class="btn-link" id="selectFileBtn">chọn
                                file</button></p>
                        <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;">
                        <small>Hỗ trợ định dạng: .xlsx, .xls (tối đa 10MB)</small>
                    </div>

                    <div class="template-section">
                        <h4>Tải template mẫu</h4>
                        <p>Tải file template để biết cấu trúc dữ liệu chuẩn</p>
                        <button class="btn btn-outline" id="downloadTemplateBtn">
                            <i class="fas fa-download"></i>
                            Tải template
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="cancelImportBtn">Hủy</button>
                <button type="button" class="btn btn-primary" id="startImportBtn" disabled>
                    <i class="fas fa-upload"></i>
                    Bắt đầu nhập
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="class_management.js"></script>
</body>

</html>